<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snowify</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- ═══════ Title Bar ═══════ -->
  <div id="titlebar">
    <div class="titlebar-drag">
      <div class="app-logo">
        <img class="app-logo-icon" src="../../assets/logo.png" alt="Snowify" width="24" height="24" draggable="false" />
        <span>Snowify</span>
      </div>
    </div>
    <div class="titlebar-controls">
      <button class="tb-btn" id="btn-minimize" aria-label="Minimize">
        <svg width="12" height="12" viewBox="0 0 12 12"><rect y="5" width="12" height="2" rx="1" fill="currentColor"/></svg>
      </button>
      <button class="tb-btn" id="btn-maximize" aria-label="Maximize">
        <svg width="12" height="12" viewBox="0 0 12 12"><rect x="1" y="1" width="10" height="10" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/></svg>
      </button>
      <button class="tb-btn tb-close" id="btn-close" aria-label="Close">
        <svg width="12" height="12" viewBox="0 0 12 12"><path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
    </div>
  </div>

  <!-- ═══════ Welcome / Login Screen ═══════ -->
  <div id="welcome-overlay" class="welcome-overlay hidden">
    <div class="welcome-card">
      <img class="welcome-logo" src="../../assets/logo.png" alt="Snowify" width="64" height="64" draggable="false" />
      <h1 class="welcome-title">Welcome to Snowify</h1>
      <p class="welcome-desc">Sign in to sync your playlists, liked songs, and settings across all your devices.</p>
      <div class="auth-form" id="welcome-auth-form">
        <input type="email" id="welcome-email" class="auth-input" placeholder="Email" spellcheck="false" autocomplete="email" />
        <input type="password" id="welcome-password" class="auth-input" placeholder="Password" autocomplete="current-password" />
        <p class="auth-error hidden" id="welcome-auth-error"></p>
        <div class="welcome-buttons">
          <button class="btn-welcome-primary" id="btn-welcome-sign-in">Sign In</button>
          <button class="btn-welcome-secondary" id="btn-welcome-sign-up">Create Account</button>
        </div>
      </div>
      <button class="btn-welcome-skip" id="btn-welcome-skip">Continue without an account</button>
      <p class="welcome-warning">Without an account, your data is stored locally and can't be recovered if lost.</p>
    </div>
  </div>

  <!-- ═══════ Main Layout ═══════ -->
  <div id="app">
    <!-- Sidebar -->
    <aside id="sidebar">
      <nav class="sidebar-nav">
        <button class="nav-btn active" data-view="home">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3L4 9v12h5v-7h6v7h5V9l-8-6z"/></svg>
          <span>Home</span>
        </button>
        <button class="nav-btn" data-view="explore">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
          <span>Explore</span>
        </button>
        <button class="nav-btn" data-view="search" style="display:none">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="7"/><path d="M16 16l4.5 4.5" stroke-linecap="round"/></svg>
          <span>Search</span>
        </button>
        <button class="nav-btn" data-view="library">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h2v16H4V4zm5 0h2v16H9V4zm5 2h2v14h-2V6zm5-2h2v16h-2V4z"/></svg>
          <span>Library</span>
        </button>
        <button class="nav-btn" data-view="settings">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.49.49 0 00-.59-.22l-2.39.96a7.04 7.04 0 00-1.62-.94l-.36-2.54a.48.48 0 00-.48-.41h-3.84a.48.48 0 00-.48.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96a.49.49 0 00-.59.22L2.74 8.87a.48.48 0 00.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.26.41.48.41h3.84c.24 0 .44-.17.48-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32a.49.49 0 00-.12-.61l-2.03-1.58zM12 15.6A3.6 3.6 0 1115.6 12 3.6 3.6 0 0112 15.6z"/></svg>
          <span>Settings</span>
        </button>
      </nav>

      <div class="sidebar-section">
        <div class="sidebar-section-header">
          <h3>Playlists</h3>
          <div class="sidebar-header-actions">
            <button class="icon-btn" id="btn-spotify-import" title="Import from Spotify">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.6 0 12 0zm5.52 17.28c-.24.36-.66.48-1.02.24-2.82-1.74-6.36-2.1-10.56-1.14-.42.12-.78-.18-.9-.54-.12-.42.18-.78.54-.9 4.56-1.02 8.52-.6 11.7 1.32.36.24.48.66.24 1.02zm1.44-3.3c-.3.42-.84.6-1.26.3-3.24-1.98-8.16-2.58-11.94-1.38-.48.12-.99-.12-1.14-.6-.12-.48.12-.99.6-1.14 4.38-1.32 9.78-.66 13.5 1.62.36.18.54.78.24 1.2zm.12-3.36C15.24 8.4 8.88 8.16 5.16 9.3c-.6.18-1.2-.18-1.38-.72-.18-.6.18-1.2.72-1.38 4.26-1.26 11.28-1.02 15.72 1.62.54.3.72 1.02.42 1.56-.3.42-1.02.6-1.56.3z"/></svg>
            </button>
            <button class="icon-btn" id="btn-create-playlist" title="Create playlist">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M10 3v14M3 10h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
            </button>
          </div>
        </div>
        <div id="playlist-list" class="playlist-list">
          <div class="playlist-item" data-playlist="liked">
            <div class="playlist-cover liked-cover">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="#fff"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            </div>
            <div class="playlist-info">
              <span class="playlist-name">Liked Songs</span>
              <span class="playlist-count">0 songs</span>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main id="main-content">
      <!-- Floating search pill -->
      <div id="floating-search" class="floating-search">
        <svg class="floating-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="7"/><path d="M16 16l4.5 4.5" stroke-linecap="round"/></svg>
        <span class="floating-search-text">Search</span>
      </div>

      <!-- ── Home View ── -->
      <section class="view active" id="view-home">
        <div class="view-header">
          <h1>Good <span id="greeting-time">evening</span></h1>
        </div>
        <div class="quick-picks" id="quick-picks">
          <!-- populated by JS -->
        </div>
        <div class="section">
          <h2>Recently Played</h2>
          <div class="card-row" id="recent-tracks">
            <div class="empty-state">
              <p>Your recently played tracks will show up here.</p>
              <p>Start by searching for something!</p>
            </div>
          </div>
        </div>
        <div class="section" id="new-releases-section" style="display:none">
          <h2>New From Artists You Follow</h2>
          <div class="album-scroll" id="new-releases"></div>
        </div>
        <div class="section" id="recommended-songs-section" style="display:none">
          <h2>Recommended Songs</h2>
          <div class="card-row" id="recommended-songs"></div>
        </div>
      </section>

      <!-- ── Explore View ── -->
      <section class="view" id="view-explore">
        <div class="view-header">
          <h1>Explore</h1>
        </div>
        <div class="explore-content" id="explore-content">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </section>

      <!-- ── Search View ── -->
      <section class="view" id="view-search">
        <div class="search-bar-container">
          <div class="search-input-wrap">
            <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="7"/><path d="M16 16l4.5 4.5" stroke-linecap="round"/></svg>
            <input type="text" id="search-input" placeholder="What do you want to listen to?" spellcheck="false" autocomplete="off" />
            <button class="search-clear hidden" id="search-clear" aria-label="Clear">
              <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            </button>
            <div id="search-suggestions" class="search-suggestions hidden"></div>
          </div>
        </div>
        <div id="search-results" class="track-list">
          <div class="empty-state search-empty">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#535353" stroke-width="1.5"><circle cx="11" cy="11" r="7"/><path d="M16 16l4.5 4.5" stroke-linecap="round"/></svg>
            <p>Search for songs, artists, albums, or playlists</p>
          </div>
        </div>
      </section>

      <!-- ── Library View ── -->
      <section class="view" id="view-library">
        <div class="view-header">
          <h1>Your Library</h1>
        </div>
        <div id="library-content" class="track-list">
          <div class="empty-state">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="#535353"><path d="M4 4h2v16H4V4zm5 0h2v16H9V4zm5 2h2v14h-2V6zm5-2h2v16h-2V4z"/></svg>
            <h3>Create your first playlist</h3>
            <p>It's easy — we'll help you</p>
            <button class="btn-primary" id="btn-lib-create-playlist">Create playlist</button>
          </div>
        </div>
      </section>

      <!-- ── Playlist Detail View ── -->
      <section class="view" id="view-playlist">
        <div class="playlist-header" id="playlist-detail-header">
          <div class="playlist-hero-cover" id="playlist-hero-cover"></div>
          <div class="playlist-hero-info">
            <span class="playlist-type">PLAYLIST</span>
            <h1 class="playlist-hero-name" id="playlist-hero-name">My Playlist</h1>
            <span class="playlist-hero-count" id="playlist-hero-count">0 songs</span>
          </div>
        </div>
        <div class="playlist-actions">
          <button class="play-all-btn" id="btn-play-all" title="Play all">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#000"><path d="M8 5v14l11-7L8 5z"/></svg>
          </button>
          <button class="icon-btn playlist-action-btn" id="btn-shuffle-playlist" title="Shuffle play">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/></svg>
          </button>
          <span class="playlist-actions-spacer"></span>
          <button class="icon-btn playlist-action-btn" id="btn-export-playlist" title="Export as CSV">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          </button>
          <button class="icon-btn playlist-action-btn" id="btn-cover-playlist" title="Change cover">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
          </button>
          <button class="icon-btn playlist-action-btn" id="btn-rename-playlist" title="Rename playlist">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          </button>
          <button class="icon-btn playlist-action-btn btn-delete" id="btn-delete-playlist" title="Delete playlist">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
          </button>
        </div>
        <div id="playlist-tracks" class="track-list"></div>
      </section>

      <!-- ── Album Detail View ── -->
      <section class="view" id="view-album">
        <div class="playlist-header" id="album-detail-header">
          <div class="playlist-hero-cover" id="album-hero-cover">
            <img id="album-hero-img" src="" alt="" />
          </div>
          <div class="playlist-hero-info">
            <span class="playlist-type" id="album-hero-type">ALBUM</span>
            <h1 class="playlist-hero-name" id="album-hero-name">Album</h1>
            <span class="playlist-hero-count" id="album-hero-meta"></span>
          </div>
        </div>
        <div class="playlist-actions">
          <button class="play-all-btn" id="btn-album-play-all" title="Play all">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#000"><path d="M8 5v14l11-7L8 5z"/></svg>
          </button>
          <button class="icon-btn playlist-action-btn" id="btn-album-shuffle" title="Shuffle play">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/></svg>
          </button>
          <button class="icon-btn playlist-action-btn" id="btn-album-save" title="Save to library" style="display:none;">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          </button>
        </div>
        <div id="album-tracks" class="track-list"></div>
      </section>

      <!-- ── Settings View ── -->
      <section class="view" id="view-settings">
        <div class="settings-content">
          <div class="view-header">
            <h1>Settings</h1>
          </div>
          <div class="settings-group">
            <h3>Account</h3>
            <div id="account-section">
              <div id="account-signed-out">
                <p class="setting-desc" style="margin-bottom:12px;">Sign in to sync your playlists, liked songs, and settings across devices.</p>
                <div class="auth-form" id="auth-form">
                  <input type="email" id="auth-email" class="auth-input" placeholder="Email" spellcheck="false" autocomplete="email" />
                  <input type="password" id="auth-password" class="auth-input" placeholder="Password" autocomplete="current-password" />
                  <div class="auth-buttons">
                    <button class="btn-setting-action" id="btn-sign-in">Sign In</button>
                    <button class="btn-setting-action" id="btn-sign-up">Create Account</button>
                  </div>
                  <p class="auth-error hidden" id="auth-error"></p>
                </div>
              </div>
              <div id="account-signed-in" class="hidden">
                <div class="profile-section">
                  <div class="profile-avatar-wrapper">
                    <img class="profile-avatar" id="profile-avatar" src="" alt="" draggable="false" />
                    <button class="profile-avatar-edit" id="btn-change-avatar" title="Change profile picture">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 000-1.41l-2.34-2.34a1 1 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                    </button>
                  </div>
                  <div class="profile-info">
                    <div class="profile-name-row">
                      <span class="profile-display-name" id="profile-display-name">User</span>
                      <button class="profile-edit-btn" id="btn-edit-name" title="Edit display name">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 000-1.41l-2.34-2.34a1 1 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                      </button>
                    </div>
                    <span class="profile-email" id="profile-email"></span>
                    <span class="setting-desc" id="account-sync-status"></span>
                  </div>
                </div>
                <div class="profile-edit-row hidden" id="profile-edit-name-row">
                  <input type="text" class="auth-input" id="profile-name-input" placeholder="Display name" maxlength="30" />
                  <button class="btn-setting-action" id="btn-save-name">Save</button>
                  <button class="btn-setting-action" id="btn-cancel-name">Cancel</button>
                </div>
                <div class="account-actions" style="margin-top: 12px;">
                  <button class="btn-setting-action" id="btn-sync-now">Sync Now</button>
                  <button class="btn-setting-action btn-danger" id="btn-sign-out">Sign Out</button>
                </div>
              </div>
            </div>
            <div class="setting-row" style="margin-top: 16px;">
              <div class="setting-info">
                <span class="setting-label">Country</span>
                <span class="setting-desc">Localizes Explore recommendations</span>
              </div>
              <select class="setting-select" id="setting-country">
                <option value="">Not set</option>
                <option value="AR">Argentina</option>
                <option value="AU">Australia</option>
                <option value="AT">Austria</option>
                <option value="BE">Belgium</option>
                <option value="BR">Brazil</option>
                <option value="CA">Canada</option>
                <option value="CL">Chile</option>
                <option value="CO">Colombia</option>
                <option value="CZ">Czechia</option>
                <option value="DK">Denmark</option>
                <option value="EG">Egypt</option>
                <option value="FI">Finland</option>
                <option value="FR">France</option>
                <option value="DE">Germany</option>
                <option value="GR">Greece</option>
                <option value="HU">Hungary</option>
                <option value="IN">India</option>
                <option value="ID">Indonesia</option>
                <option value="IE">Ireland</option>
                <option value="IL">Israel</option>
                <option value="IT">Italy</option>
                <option value="JP">Japan</option>
                <option value="KE">Kenya</option>
                <option value="MY">Malaysia</option>
                <option value="MX">Mexico</option>
                <option value="NL">Netherlands</option>
                <option value="NZ">New Zealand</option>
                <option value="NG">Nigeria</option>
                <option value="NO">Norway</option>
                <option value="PK">Pakistan</option>
                <option value="PE">Peru</option>
                <option value="PH">Philippines</option>
                <option value="PL">Poland</option>
                <option value="PT">Portugal</option>
                <option value="RO">Romania</option>
                <option value="RU">Russia</option>
                <option value="SA">Saudi Arabia</option>
                <option value="SG">Singapore</option>
                <option value="ZA">South Africa</option>
                <option value="KR">South Korea</option>
                <option value="ES">Spain</option>
                <option value="SE">Sweden</option>
                <option value="CH">Switzerland</option>
                <option value="TW">Taiwan</option>
                <option value="TH">Thailand</option>
                <option value="TR">Türkiye</option>
                <option value="UA">Ukraine</option>
                <option value="AE">United Arab Emirates</option>
                <option value="GB">United Kingdom</option>
                <option value="US">United States</option>
                <option value="VN">Vietnam</option>
              </select>
            </div>
          </div>
          <div class="settings-group">
            <h3>Playback</h3>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Autoplay</span>
                <span class="setting-desc">Continue playing similar songs when queue ends</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="setting-autoplay" />
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Discord Rich Presence</span>
                <span class="setting-desc">Show what you're listening to on Discord</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="setting-discord-rpc" />
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Audio quality</span>
                <span class="setting-desc">Higher quality uses more bandwidth</span>
              </div>
              <select class="setting-select" id="setting-quality">
                <option value="bestaudio">Best</option>
                <option value="worstaudio">Low</option>
              </select>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Crossfade</span>
                <span class="setting-desc">Smoothly transition between songs</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="setting-crossfade-toggle" />
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="setting-row crossfade-slider-row hidden" id="crossfade-slider-row">
              <div class="crossfade-slider-wrap">
                <span class="crossfade-label-min">1s</span>
                <div class="crossfade-slider" id="crossfade-slider">
                  <div class="crossfade-fill" id="crossfade-fill">
                    <div class="crossfade-handle" id="crossfade-handle"></div>
                  </div>
                </div>
                <span class="crossfade-label-max">12s</span>
                <span class="crossfade-label-value" id="crossfade-value">5s</span>
              </div>
            </div>
          </div>
          <div class="settings-group">
            <h3>Video</h3>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Video quality</span>
                <span class="setting-desc">Resolution for in-app video playback</span>
              </div>
              <select class="setting-select" id="setting-video-quality">
                <option value="480">480p</option>
                <option value="720">720p</option>
                <option value="1080">1080p</option>
              </select>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Use pre-muxed videos</span>
                <span class="setting-desc">Faster loading, lower quality (disable for HD)</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="setting-video-premuxed" checked />
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          <div class="settings-group">
            <h3>Appearance</h3>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Theme</span>
                <span class="setting-desc">Choose a color theme for the app</span>
              </div>
              <select class="setting-select" id="theme-select">
                <option value="dark">Dark</option>
                <option value="light">Light</option>
                <option value="ocean">Ocean</option>
                <option value="forest">Forest</option>
                <option value="sunset">Sunset</option>
                <option value="rose">Rose</option>
                <option value="midnight">Midnight</option>
              </select>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Custom themes</span>
                <span class="setting-desc">Add custom .css files</span>
              </div>
              <div class="custom-theme-actions">
                <button class="btn-setting-action" id="btn-add-theme" title="Add a .css theme file">Add theme</button>
                <button class="btn-setting-action" id="btn-reload-theme" title="Reload current custom theme from disk">Reload</button>
                <button class="btn-setting-action" id="btn-open-themes" title="Open themes folder">Open folder</button>
                <button class="btn-setting-action btn-danger" id="btn-remove-theme" title="Remove the currently selected custom theme">Remove</button>
              </div>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Animations</span>
                <span class="setting-desc">Enable smooth transitions and animations throughout the app</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="setting-animations" checked />
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Visual effects</span>
                <span class="setting-desc">Glow, blur and shadow effects (disable for better performance)</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="setting-effects" checked />
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          <div class="settings-group">
            <h3>Data</h3>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Clear play history</span>
                <span class="setting-desc">Remove recently played tracks from home</span>
              </div>
              <button class="btn-setting-action" id="setting-clear-history">Clear</button>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Clear search history</span>
                <span class="setting-desc">Remove all saved search queries</span>
              </div>
              <button class="btn-setting-action" id="setting-clear-search-history">Clear</button>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Reset all data</span>
                <span class="setting-desc">Delete all playlists, liked songs, and settings</span>
              </div>
              <button class="btn-setting-action btn-danger" id="setting-reset-all">Reset</button>
            </div>
          </div>

          <div class="settings-group">
            <h3>About</h3>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Version</span>
                <span class="setting-desc" id="app-version-label">Loading...</span>
              </div>
              <button class="btn-setting-action" id="btn-check-update">Check for updates</button>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Changelog</span>
                <span class="setting-desc">See what's new in this version</span>
              </div>
              <button class="btn-setting-action" id="btn-open-changelog">View changelog</button>
            </div>
            <div class="setting-row" id="update-status-row" style="display:none;">
              <div class="setting-info">
                <span class="setting-label" id="update-status-label">Checking...</span>
                <span class="setting-desc" id="update-status-desc"></span>
              </div>
              <button class="btn-setting-action" id="btn-install-update" style="display:none;">Download &amp; Install</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ── Artist View ── -->
      <section class="view" id="view-artist">
        <div class="artist-banner" id="artist-banner" style="display:none">
          <img class="artist-banner-img" id="artist-banner-img" src="" alt="" />
          <div class="artist-banner-fade"></div>
        </div>
        <div class="artist-header">
          <img class="artist-avatar" id="artist-avatar" src="" alt="" />
          <div class="artist-header-info">
            <span class="artist-verified">ARTIST</span>
            <h1 class="artist-name" id="artist-name">Artist</h1>
            <span class="artist-followers" id="artist-followers"></span>
          </div>
        </div>
        <div class="artist-actions">
          <button class="play-all-btn" id="btn-artist-play-all" title="Play all">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#000"><path d="M8 5v14l11-7L8 5z"/></svg>
          </button>
          <button class="follow-btn" id="btn-artist-follow">Follow</button>
          <button class="follow-btn" id="btn-artist-share" title="Copy link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
          </button>
        </div>
        <div class="artist-section" id="artist-about-section" style="display:none;">
          <h2>About</h2>
          <p class="artist-description" id="artist-description"></p>
          <div class="artist-tags" id="artist-tags"></div>
        </div>
        <div class="artist-section">
          <h2>Popular</h2>
          <div id="artist-popular-tracks" class="track-list"></div>
        </div>
        <div class="artist-section">
          <h2>Discography</h2>
          <div class="disco-filters" id="disco-filters">
            <button class="disco-filter active" data-filter="all">Popular releases</button>
            <button class="disco-filter" data-filter="Album">Albums</button>
            <button class="disco-filter" data-filter="Single">Singles</button>
          </div>
          <div id="artist-discography" class="album-scroll"></div>
        </div>
        <div class="artist-section" id="artist-featured-section" style="display:none;">
          <h2>Playlists</h2>
          <div id="artist-featured" class="album-scroll"></div>
        </div>
        <div class="artist-section" id="artist-videos-section" style="display:none;">
          <h2>Music Videos</h2>
          <div id="artist-videos" class="album-scroll"></div>
        </div>
        <div class="artist-section" id="artist-live-section" style="display:none;">
          <h2>Live Performances</h2>
          <div id="artist-live" class="album-scroll"></div>
        </div>
        <div class="artist-section" id="artist-fans-section" style="display:none;">
          <h2>Fans might also like</h2>
          <div id="artist-fans" class="similar-artists-scroll"></div>
        </div>
      </section>
    </main>
  </div>

  <!-- ═══════ Now Playing Bar ═══════ -->
  <footer id="now-playing-bar" class="hidden">
    <div class="np-track-info">
      <img id="np-thumbnail" src="" alt="" />
      <div class="np-text">
        <span class="np-title" id="np-title">—</span>
        <span class="np-artist" id="np-artist">—</span>
      </div>
      <button class="icon-btn np-like" id="np-like" title="Like">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
      </button>
    </div>

    <div class="np-controls">
      <div class="np-buttons">
        <button class="icon-btn" id="btn-shuffle" title="Shuffle">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/><path d="M4 20L9 15" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M4 4L9 9" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M15 15L21 21" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M21 3L14 10" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M16 3H21V8" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 16V21H16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button class="icon-btn" id="btn-prev" title="Previous">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6V6zm3.5 6l8.5 6V6l-8.5 6z"/></svg>
        </button>
        <button class="play-btn" id="btn-play-pause" title="Play">
          <svg class="icon-play" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7L8 5z"/></svg>
          <svg class="icon-pause hidden" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>
        </button>
        <button class="icon-btn" id="btn-next" title="Next">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M16 6h2v12h-2V6zM6 18l8.5-6L6 6v12z"/></svg>
        </button>
        <button class="icon-btn" id="btn-repeat" title="Repeat">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 014-4h14"/><path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 01-4 4H3"/></svg>
        </button>
      </div>
      <div class="np-progress">
        <span class="time" id="time-current">0:00</span>
        <div class="progress-bar" id="progress-bar">
          <div class="progress-fill" id="progress-fill">
            <div class="progress-handle" id="progress-handle"></div>
          </div>
        </div>
        <span class="time" id="time-total">0:00</span>
      </div>
    </div>

    <div class="np-extras">
      <button class="icon-btn" id="btn-lyrics" title="Lyrics">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.35em" height="1.35em" viewBox="0 0 15 15"><title xmlns="">karaoke</title><path fill="currentColor" d="M12.1 2.952a2.988 2.988 0 0 0-5.11 1.965l3.142 3.142A2.988 2.988 0 0 0 12.1 2.952m-7.428 5.3L2.55 10.377a1 1 0 0 0 0 1.414l.707.707a1 1 0 0 0 1.414 0l2.121-2.121l2.122-2.122l-2.121-2.121Zm.741 2.087l-.707-.707l2.087-2.084l.707.707Z"/></svg>
      </button>
      <button class="icon-btn" id="btn-queue" title="Queue">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M4 6h16v2H4V6zm0 5h16v2H4v-2zm0 5h10v2H4v-2zm14-1v6l5-3-5-3z"/></svg>
      </button>
      <div class="volume-control">
        <button class="icon-btn" id="btn-volume" title="Volume">
          <svg class="vol-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3z"/><path class="vol-wave" d="M14 9.64a3.99 3.99 0 010 4.72M16.5 7a7.97 7.97 0 010 10" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
          <svg class="vol-mute-icon hidden" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3z"/><path d="M16 9l6 6M22 9l-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
        </button>
        <div class="volume-slider" id="volume-slider">
          <div class="volume-fill" id="volume-fill">
            <div class="volume-handle" id="volume-handle"></div>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- ═══════ Queue Panel ═══════ -->
  <div id="queue-panel" class="queue-panel hidden">
    <div class="queue-header">
      <div class="queue-tabs">
        <button class="queue-tab active" data-tab="queue">Queue</button>
        <button class="queue-tab" data-tab="history">Recently Played</button>
      </div>
      <button class="icon-btn" id="btn-close-queue">
        <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
    </div>
    <!-- Queue View -->
    <div id="queue-view" class="queue-view">
      <div class="queue-section">
        <h4>Now Playing</h4>
        <div id="queue-now-playing"></div>
      </div>
      <div class="queue-section">
        <div class="queue-section-header">
          <h4>Up Next</h4>
          <button class="queue-clear-btn" id="btn-clear-queue">Clear</button>
        </div>
        <div id="queue-up-next"></div>
      </div>
    </div>
    <!-- History View -->
    <div id="history-view" class="queue-view" style="display:none;">
      <div class="queue-section">
        <h4>Now Playing</h4>
        <div id="history-now-playing"></div>
      </div>
      <div class="queue-section">
        <div class="queue-section-header">
          <h4>Recently Played</h4>
          <button class="queue-clear-btn" id="btn-clear-history">Clear</button>
        </div>
        <div id="history-list"></div>
      </div>
    </div>
  </div>

  <!-- ═══════ Lyrics Panel ═══════ -->
  <div id="lyrics-panel" class="lyrics-panel hidden">
    <div class="lyrics-header">
      <h3>Lyrics</h3>
      <button class="icon-btn" id="btn-close-lyrics">
        <svg width="16" height="16" viewBox="0 0 16 16"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
    </div>
    <div class="lyrics-body" id="lyrics-body">
      <div class="lyrics-empty">
        <p>Play a song to see lyrics</p>
      </div>
    </div>
  </div>

  <!-- ═══════ Input Modal ═══════ -->
  <div id="input-modal" class="modal-overlay hidden">
    <div class="modal-box">
      <h3 id="input-modal-title">Enter name</h3>
      <input type="text" id="input-modal-input" spellcheck="false" autocomplete="off" />
      <div class="modal-buttons">
        <button class="modal-btn modal-cancel" id="input-modal-cancel">Cancel</button>
        <button class="modal-btn modal-confirm" id="input-modal-ok">OK</button>
      </div>
    </div>
  </div>

  <!-- ═══════ Spotify Import Modal ═══════ -->
  <div id="spotify-modal" class="modal-overlay hidden">
    <div class="modal-box spotify-modal-box">
      <h3 id="spotify-modal-title">Import Spotify Playlists</h3>
      <div id="spotify-step-url" class="spotify-step">
        <p class="spotify-step-desc">Export your Spotify playlists as CSV using <a href="#" id="spotify-exportify-link">playlistexport.com</a>, then import the files here.</p>
        <button class="modal-btn spotify-pick-btn" id="spotify-pick-files">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
          Select CSV Files
        </button>
        <div id="spotify-file-list" class="spotify-file-list hidden"></div>
        <p class="spotify-error hidden" id="spotify-error"></p>
        <div class="modal-buttons">
          <button class="modal-btn modal-cancel" id="spotify-cancel">Cancel</button>
          <button class="modal-btn modal-confirm" id="spotify-start" disabled>Import</button>
        </div>
      </div>
      <div id="spotify-step-progress" class="spotify-step hidden">
        <div class="spotify-progress-info">
          <span id="spotify-progress-text">Matching tracks...</span>
          <span id="spotify-progress-count">0 / 0</span>
        </div>
        <div class="spotify-progress-bar">
          <div class="spotify-progress-fill" id="spotify-progress-fill"></div>
        </div>
        <div class="spotify-track-list" id="spotify-track-list"></div>
        <div class="modal-buttons" id="spotify-done-buttons" style="display:none">
          <button class="modal-btn modal-confirm" id="spotify-done">Done</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══════ Video Player Overlay ═══════ -->
  <div id="video-overlay" class="video-overlay hidden">
    <div class="video-overlay-header">
      <div class="video-overlay-info">
        <span class="video-overlay-title" id="video-overlay-title"></span>
        <span class="video-overlay-artist" id="video-overlay-artist"></span>
      </div>
      <button class="icon-btn video-overlay-close" id="btn-close-video" title="Close">
        <svg width="20" height="20" viewBox="0 0 16 16"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
    </div>
    <div class="video-container">
      <video id="video-player" controls></video>
      <div class="video-loading hidden" id="video-loading">
        <div class="spinner"></div>
        <p>Loading video...</p>
      </div>
    </div>
  </div>

  <!-- ═══════ Changelog Modal ═══════ -->
  <div id="changelog-modal" class="modal-overlay hidden">
    <div class="modal-box changelog-modal-box">
      <div class="changelog-header">
        <h3 id="changelog-title">What's New</h3>
        <button class="icon-btn" id="changelog-close" title="Close">
          <svg width="18" height="18" viewBox="0 0 16 16"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
      </div>
      <div class="changelog-meta" id="changelog-meta"></div>
      <div class="changelog-body" id="changelog-body">
        <div class="changelog-loading"><div class="spinner"></div><p>Loading changelog...</p></div>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn modal-confirm" id="changelog-ok">Got it</button>
      </div>
    </div>
  </div>

  <!-- ═══════ Notification Toast ═══════ -->
  <div id="toast" class="toast hidden"></div>

  <audio id="audio-player" preload="auto"></audio>
  <audio id="audio-player-b" preload="auto"></audio>
  <script src="crossfade-engine.js"></script>
  <script src="app.js"></script>
</body>
</html>
